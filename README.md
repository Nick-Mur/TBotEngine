# Разработка Игры на Движке

## Описание проекта

**TBotEngine** — это движок для создания Telegram-ботов с готовым набором базовых команд, встроенной монетизацией и уникальной системой "одного сообщения", где основной текст отображается в рамках одного редактируемого сообщения. Данный подход обеспечивает более удобное взаимодействие пользователя с ботом, минимизируя количество сообщений в чате.

## Особенности

- **Готовый набор базовых команд**: Начните разработку с уже настроенными основными командами, такими как `/start`, `/save`, `/ads`' и другие.
- **Встроенная монетизация**: Поддержка платежей через Telegram, управление токенами, рекламой и транзакциями.
- **Система одного сообщения**: Основной контент отображается в одном редактируемом сообщении, улучшая пользовательский опыт.
- **Гибкая структура**: Возможность легко расширять функциональность, добавлять новые команды, фразы, медиа и многое другое.

## Установка

1. **Клонируйте репозиторий:**

   ```bash
   git clone https://github.com/Nick-Mur/TBotEngine.git
   ```

2. **Перейдите в директорию проекта:**

   ```bash
   cd TBotEngine
   ```

3. **Создайте виртуальное окружение и активируйте его:**

   ```bash
   python3 -m venv venv
   source venv/bin/activate  # Для Unix или MacOS
   venv\Scripts\activate     # Для Windows
   ```

4. **Установите зависимости:**

   ```bash
   pip install -r requirements.txt
   ```

## Далее будет описание того, как работать с движком.

## Содержание

1. [Создание новых кнопок](#1-создание-новых-кнопок)
2. [Объединение кнопок в новые клавиатуры](#2-объединение-кнопок-в-новые-клавиатуры)
3. [Добавление медиа](#3-добавление-медиа)
4. [Запись медиа в переменные](#4-запись-медиа-в-переменные)
5. [Написание новых фраз](#5-написание-новых-фраз)
   - [Добавление новых языков](#добавление-новых-языков)
6. [Объединение фраз, медиа и клавиатур в сообщения](#6-объединение-фраз-медиа-и-клавиатур-в-сообщения)
7. [Работа с картой](#7-работа-с-картой)
8. [.env](#8-env)
9. [consts](#9-consts)
10. [Заключение](#заключение)

---

## 1. Создание новых кнопок

Кнопки в боте создаются с использованием класса `InlineKeyboardButton` из библиотеки Aiogram. Каждая кнопка имеет текст и действие, которое выполняется при её нажатии.

**Пример создания кнопки:**

```python
from aiogram.types import InlineKeyboardButton

button_start = InlineKeyboardButton(text="Начать игру", callback_data="A")
```

- `text`: Текст, отображаемый на кнопке.
- `callback_data`: Данные, которые будут отправлены боту при нажатии на кнопку.

Добавление кнопок происходит в 'resources/buttons.py'

**Пример кнопки:**

```python
close_btn = Button(text='❌', callback_data='close')
```
P.s. вместо InlineKeyboardButton используется сокращение Button

**Советы:**

- Используйте понятные и краткие тексты для кнопок.
- `callback_data` должен содержать результат выбора, сам выбор должен быть описан в сообщение.

---

## 2. Объединение кнопок в новые клавиатуры

Клавиатуры позволяют объединять кнопки в группы и отправлять их вместе с сообщением. Для создания клавиатуры используйте класс `InlineKeyboardMarkup`.

**Пример создания клавиатуры с двумя кнопками в одной строке:**

```python
from aiogram.types import InlineKeyboardMarkup

keyboard_main = InlineKeyboardMarkup(row_width=2)
keyboard_main.add(button_start, button_help)
```

- `row_width`: Количество кнопок в одной строке.
- Метод `add`: Добавляет кнопки в клавиатуру слева направо.

**Добавление кнопок в разные строки:**

```python
keyboard = InlineKeyboardMarkup()
keyboard.row(button1, button2)
keyboard.add(button3)
```

- `row()`: Создаёт новую строку с указанными кнопками.
- `add()`: Добавляет кнопку в новую строку.

---

Добавление клавиатур происходит в 'resources/keyboards.py'

**Пример клавиатуры:**

```python
basic_0 = [[back_0_btn, next_0_btn]]
back_0 = [[back_0_btn]]
```
P.s. движок сам преобразуется подобные массивы в клавиатуры. Внешние [] - сама клавиатура, внутренние [] - строчка


## 3. Добавление медиа

Медиа-контент (изображения, видео, аудио) добавляются в 'resources/media' и далее в соответсвующую папку (например, images).

## 4. Запись медиа в переменные

Название файла необходимо записывать в переменные в 'resources/media/media_py/media_0.py'.

**Пример:**

```python
media_0_0_0 = 'snapedit_1722016659293.jpeg'
```

**Советы:**

- Вторая цифра отвечает за блок (сообщение), третья - за номер фразы, к которой привязан медиа файл.

---

## 5. Написание новых фраз

Все фразы хранятся в переменных в 'resources/phrases/' и далее нужный язык.

**Пример:**

```python
ru_phrase_0_0_0 = 'Всем привет!'
```

**Советы:**

- Также можно добавлять свои особые выделение через функции в файле 'utils/decorate_text.py'

### Добавление новых языков

Добавление новых происходит по средстам добавления новых кнопок в языковую клавиатуру.

**Пример кнопки:**

```python
rus_btn = Button(text="Русский", callback_data="language_ru")
```

**Сама клавиатура:**

```python
language_keyboard = Keyboard(inline_keyboard=[[close_btn], [rus_btn, eng_btn]])
```

Также важно, фразы находятся в соответствующих папках!

---

## 6. Объединение фраз, медиа и клавиатур в сообщения

Теперь, когда у вас есть фразы, медиа и клавиатуры, их можно объединять для отправки пользователю в 'resources/messages/messages_0'.

**Пример сообщения:**

```python
message_0_0 = [
    {text: 'phrase_0_0_0', media: 'media_0_0_0', keyboard: 'next_0'},
    {text: 'phrase_0_0_1', media: 'media_0_0_0'},
    {text: 'phrase_0_0_2', media: 'media_0_0_1', keyboard: 'ab_0'}
]
```

**Советы:**

- Клаиавиатура по умолчанию - стрелка вперёд и назад.

---

## 7. Работа с картой

Карта игры определяет логику переходов между состояниями или этапами игры. Она  реализована в виде внешнего файла, описывающего связи между сообщениями.

**Пример карты в текстовом файле `utils/maps_txtf/map_0.txt`:**

```
1 > 2
2 > 3
3 > 4 [1=A + 2=B]
3 > 5 [1=B + 2=A]
3 > 6 [1=C + 3=A]
3 > 7 [else]
```

- **from_id**: Текущий этап (первая цифра).
- **to_id**: Следующий этап (вторая цифра).
- **condition**: Условие перехода (в квадратных скобках).

---

## 8. .env

Для успешной работы бота необходимо создать файл .env в основной директории

**Наполнение:**

```python
BOT_TOKEN_TEST = ...
BOT_TOKEN_WORK = ...
WEBHOOK_HOST = None  # Установите 'https://yourdomain.com' для вебхуков или None для polling

```

- `BOT_TOKEN_TEST`: Токен для тестового бота (получается у BotFather).
- `BOT_TOKEN_WORK`: Токен для общего бота.
- `WEBHOOK_HOST`: Хост, если есть/нужен.

---

## 9. consts

Для персонализации бота необходимо создать файл consts.py и поместить его в папку app

**Наполнение:**

```python
DEBUG = True
DB_PATH = 'database\project.db'
MEDIA_PHOTO = 'resources/media/images/'
SPECIAL_PHRASES = 'resources.phrases'
MESSAGE_MAP = 'utils/maps_txtf/'
TOKENS_ADD = 1
TOKENS_NEXT = 1
TOKENS_SPECIAL_MEMBER = None
TOKENS_REFERRAL = 3

CHANNEL_IDS = [
    '...',
    '@test'
]

ADMINS = [123]
OWNER = 123
```
P.s. Не рекомендуется изменять пути

---

## Заключение

Следуя этому руководству, вы сможете создавать интерактивные игры на основе нашего движка. Главное — структурировать свой код и ресурсы, чтобы облегчить разработку и поддержку проекта.

**Дополнительные ресурсы:**

- [Документация Aiogram](https://docs.aiogram.dev/en/latest/)
- [Официальное руководство по боту Telegram](https://core.telegram.org/bots)

---

**Примечание:** Данное руководство предоставляет общие рекомендации по разработке игры на движке. Детали реализации могут варьироваться в зависимости от конкретных требований и архитектуры проекта.
